<!DOCTYPE html><html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="内存分析 - Unity Manual">
<title>内存分析 - Unity Manual</title>
<meta property="og:image" content="https://docs.unity3d.com/zh_CN/2019.1/uploads/Main/UnderstandingPerformanceinUnity-MemorySection_image_0.jpg">
<meta name="description" content="内存消耗是关键的性能指标，在内存资源有限的平台（例如低端移动设备）上尤为重要。">
<meta property="og:description" content="内存消耗是关键的性能指标，在内存资源有限的平台（例如低端移动设备）上尤为重要。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'BestPracticeUnderstandingPerformanceInUnity2';
      if(!page) page = 'index';
      var version = '2019.1';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.1/Documentation/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">English</a></li>
<li><a data-lang="ja" href="/ja/2019.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/BestPracticeUnderstandingPerformanceInUnity2.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.1)</a></li>
<li><a href="BestPracticeGuides.html">最佳实践指南</a></li>
<li><a href="BestPracticeUnderstandingPerformanceInUnity.html">了解 Unity 中的优化</a></li>
<li>内存分析</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeUnderstandingPerformanceInUnity1.html"></a></span><div class="tip">性能分析</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="BestPracticeUnderstandingPerformanceInUnity3.html"></a></span><div class="tip">协程</div>
</div>
</div></div>
<h1>内存分析</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>内存消耗是关键的性能指标，在内存资源有限的平台（例如低端移动设备）上尤为重要。</p>

<h2>分析内存消耗</h2>

<p>使用 Unity Bitbucket 提供的<a href="https://bitbucket.org/Unity-Technologies/memoryprofiler">开源内存可视化工具</a>可实现 Unity 中的内存问题的最佳诊断。此工具的集成非常简单，只需下载链接的代码仓库并将包含的 <em>Editor</em> 文件夹放入项目中。</p>

<p>该工具可与 Unity 5.3 以上的任何版本结合使用。当连接到使用 IL2CPP 构建的应用程序时，此工具可以捕获有关本机代码和托管代码内存消耗情况的大量信息。</p>

<p>要使用该工具，只需使用 IL2CPP 脚本后端构建项目并将其部署到适当的设备。连接 Unity 的常规编辑器内部 CPU 性能分析器，然后打开 Memory Profiler 窗口（菜单：__Window__ &gt; <strong>MemoryProfilerWindow__）并选择 </strong>Take Snapshot__。</p>

<p>设备上的应用程序暂停一小段时间，此段时间会收集数据并传输到 Unity Editor。然后，Unity Editor 会暂停以便解析收到的数据；这可能需要很长时间。对于消耗了大量内存的应用程序，一次跟踪可能需要 10–30 分钟才能完成解析。</p>

<p>在此解析和加载操作期间，请耐心等待。</p>

<figure>
<img src="../uploads/Main/UnderstandingPerformanceinUnity-MemorySection_image_0.jpg" alt="">
</figure>

<p>此截屏来自 iOS 设备上运行的标准资源场景，其中显示有超过四分之三的内存使用量用于四个非常大的纹理，所有这些纹理都与飞机的机身有关。</p>

<p>此可视化视图可以缩放。单击应用程序中的每个框即可查看有关该框的更多信息。</p>

<h3>识别重复的纹理</h3>

<p>一个常见的内存问题是内存中的资源重复。由于纹理通常是项目中消耗内存最多的资源，因此纹理重复是 Unity 项目中最常见的内存问题之一。</p>

<p>识别重复资源可采用的方法是查找两个相同类型和相同大小的对象，这些对象看起来是从同一资源加载的。在新的内存性能分析器的详细信息面板中，检查看似相同的对象的 <strong>Name</strong> 和 <strong>InstanceID</strong> 字段。</p>

<p><strong>Name</strong> 字段基于资源文件（对象加载自该文件）的名称；通常，该名称是不包含文件路径和扩展名的文件名。<strong>InstanceID</strong> 字段表示 Unity 运行时分配的内部标识号；此数字在 Unity 游戏的单次运行中是独一无二的(1)。</p>

<figure>
<img src="../uploads/Main/UnderstandingPerformanceinUnity-MemorySection_image_1.png" alt="">
</figure>

<p>此图演示了此问题的一个简单示例。在图的左侧和右侧是从 5.4 版内存性能分析器的详细信息面板中截取的截屏。这些截屏中显示的资源是在内存中单独加载的两个纹理。纹理具有相同的名称和大小，表明它们可能是重复的。通过检查项目的“Assets”文件夹，可以确定只有一个名为 <em>wood-floorboards-texture</em> 的资源文件，这更加证明了资源被重复加载。</p>

<p>内存中的每个 UnityEngine.Object 都在对象被创建时分配一个唯一的实例 ID。由于这两个纹理具有不同的实例 ID，因此可以肯定它们代表了加载到内存中的两组不同纹理数据。</p>

<p>由于文件名和资源大小相同，而实例 ID 不同，可以肯定这两个对象表示内存中重复的纹理（注意：
 如果项目中存在具有相同文件名的纹理，那么此判断将不是绝对准确的，但在文件大小也相同时则可能性非常高）。</p>

<h4>AssetBundle 与资源重复</h4>

<p>内存中纹理和资源重复的最常见原因是 AssetBundle 卸载不当。请参阅 Unity 的 <a href="http://unity3d.com/learn/tutorials/topics/best-practices/guide-assetbundles-and-resources?playlist=30089">AssetBundle 最佳实践指南 (Best Practice Guide on AssetBundles)</a> 以了解有关此问题的描述。关键部分是<a href="http://unity3d.com/learn/tutorials/topics/best-practices/assetbundle-usage-patterns?playlist=30089">管理加载的资源 (Managing Loaded Assets)</a>。</p>

<h3>检查图像缓冲区、图像效果和 RenderTexture 内存使用情况</h3>

<p>可以通过内存可视化工具显示需要向图像和 RenderTexture 对象提供的渲染缓冲区的内存需求情况。</p>

<figure>
<img src="../uploads/Main/UnderstandingPerformanceinUnity-MemorySection_image_2.png" alt="">
</figure>

<p>上面的截屏演示了一个简单的场景，场景中应用了 Unity 的一些电影图像效果。图像效果会分配临时渲染缓冲区来执行计算；尤其是泛光特效分配了几个大小递减的缓冲区。由于 Retina iOS 设备的高分辨率，这些临时缓冲区消耗的内存远远超过项目其余部分的总量。</p>

<p>例如 iPad Air 2 的分辨率为 2048x1536，这超出了通常针对现代游戏主机和 PC 的 1080p 分辨率，但却是在平板设备上运行。一个全屏临时渲染缓冲区将占用全部的 24 或 36 兆字节内存（具体取决于缓冲区的格式）。通过将渲染缓冲区的像素大小减半，可使该内存减少 75%。这样做通常不会显著降低显示结果的视觉品质。</p>

<p>优化图像效果对临时渲染缓冲区和其他 GPU 资源的使用的方法之一是创建单个“超级”(uber) 图像效果，此特效将同时执行所有不同的计算。使用 Unity 5.5 或更高版本时，可使用新的 <a href="https://github.com/Unity-Technologies/PostProcessing">UberFX</a>（可从 <a href="https://github.com/Unity-Technologies/PostProcessing">github</a> 获取）软件包；该软件包提供了一个可配置的“超级”图像效果，此特效可以执行电影图像效果提供的所有操作，而且开销比单个图像效果更低。</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeUnderstandingPerformanceInUnity1.html"></a></span><div class="tip">性能分析</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="BestPracticeUnderstandingPerformanceInUnity3.html"></a></span><div class="tip">协程</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2019 Unity Technologies. Publication 2019.1</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
