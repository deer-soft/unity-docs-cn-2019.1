<!DOCTYPE html><html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="CPU 使用率性能分析器 (CPU Usage Profiler) - Unity Manual">
<title>CPU 使用率性能分析器 (CPU Usage Profiler) - Unity Manual</title>
<meta property="og:image" content="https://docs.unity3d.com/zh_CN/2019.1/uploads/Main/ProfilerCPU.png">
<meta name="description" content="CPU Usage Profiler 显示游戏中的时间使用情况。选择此选项后，下方面板将显示所选帧的层级时间数据。请参阅有关 Profiler 窗口的文档以了解关于 Profiler 时间轴的更多信息。">
<meta property="og:description" content="CPU Usage Profiler 显示游戏中的时间使用情况。选择此选项后，下方面板将显示所选帧的层级时间数据。请参阅有关 Profiler 窗口的文档以了解关于 Profiler 时间轴的更多信息。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'ProfilerCPU';
      if(!page) page = 'index';
      var version = '2019.1';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/ProfilerCPU.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/ProfilerCPU.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/ProfilerCPU.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/ProfilerCPU.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/ProfilerCPU.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/ProfilerCPU.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/ProfilerCPU.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/ProfilerCPU.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/ProfilerCPU.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/ProfilerCPU.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/ProfilerCPU.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/ProfilerCPU.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.1/Documentation/Manual/ProfilerCPU.html">English</a></li>
<li><a data-lang="ja" href="/ja/2019.1/Manual/ProfilerCPU.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.1/Manual/ProfilerCPU.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.1/Manual/ProfilerCPU.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/ProfilerCPU.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/ProfilerCPU.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/ProfilerCPU.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/ProfilerCPU.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/ProfilerCPU.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/ProfilerCPU.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/ProfilerCPU.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/ProfilerCPU.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/ProfilerCPU.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/ProfilerCPU.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/ProfilerCPU.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/ProfilerCPU.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.1)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="AdvancedDevelopment.html">高级开发</a></li>
<li><a href="Profiler.html">性能分析器概述</a></li>
<li>CPU 使用率性能分析器 (CPU Usage Profiler)</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProfilerWindow.html"></a></span><div class="tip">Profiler 窗口</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ProfilerRendering.html"></a></span><div class="tip">渲染性能分析器 (Rendering Profiler)</div>
</div>
</div></div>
<h1>CPU 使用率性能分析器 (CPU Usage Profiler)</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<figure>
<img src="../uploads/Main/ProfilerCPU.png" alt="">
</figure>

<p>CPU Usage Profiler 显示游戏中的时间使用情况。选择此选项后，下方面板将显示所选帧的层级时间数据。请参阅有关 <a href="ProfilerWindow.html">Profiler 窗口</a>的文档以了解关于 Profiler 时间轴的更多信息。</p>

<ul>
<li>
<strong>Hierarchy mode：</strong>显示层级时间数据。</li>
<li>
<strong>Group Hierarchy mode：</strong>将时间数据分成逻辑组（例如 Rendering、Physics、Scripts）。由于任何组的子项也可以位于不同的组中（例如，某些脚本也可能调用渲染函数），因此组时间的百分比通常总计超过 100%。</li>
</ul>

<p>上下拖动图表标签可重新排列 CPU 图表的堆叠方式。</p>

<h2>选择各项</h2>

<p>在下方面板中选择某一项时，将突出显示其对 CPU 图表的贡献（其余部分将变暗）。再次单击某一项将取消选择该项。</p>

<figure>
<img src="../uploads/Main/ProfilerCPUSelected.png" alt="已选择 Render.OpaqueGeometry 并在图表中突出显示其贡献">
<figcaption>已选择 Render.OpaqueGeometry 并在图表中突出显示其贡献</figcaption>
</figure>

<p>In the hierarchical time data, the <strong>Self</strong> column refers to the amount of time spent in a particular function, not including the time spent calling sub-functions. In the screenshot above, 1.9% of time is spent in the <code>Camera.Render</code> function. This function does some work in this frame and calls the various drawing and culling functions. Excluding all of these functions, only 0.4% of time is spent in the <code>Camera.Render</code> function itself. </p>

<p>The <strong>Time ms</strong> and <strong>Self ms</strong> columns show the same information but in milliseconds. <code>Camera.Render</code> takes 0.06ms but, including all the functions it calls, 0.31ms are consumed. The <strong>GC Alloc</strong> column shows how much memory has been allocated in the current frame, which is later collected by the garbage collector. Keep this value at zero to prevent the garbage collector from causing hiccups in your framerate.</p>

<p>CPU 性能分析器的 <strong>Others</strong> 部分记录不属于 Rendering、Scripts、Physics、Garbage Collection 或 VSync 的所有方面的总和。此部分包括 Animation、AI、Audio、Particles、Networking、Loading 和 PlayerLoop。</p>

<h2>物理标记</h2>

<p>下面的描述简要介绍了各种高级 Physics Profiler 标记的含义。</p>

<ul>
<li>
<strong>Physics.Simulate：</strong>从 <code>FixedUpdate</code> 中调用。通过指示物理引擎 (PhysX) 运行其模拟来更新物理系统的当前状态。</li>
<li>
<strong>Physics.Processing：</strong>从 <code>FixedUpdate</code> 中调用。处理所有非布料物理作业。扩展此标记可显示物理引擎内部完成的工作的低级细节。</li>
<li>
<strong>Physics.ProcessingCloth：</strong>从 <code>FixedUpdate</code> 中调用。处理所有布料物理作业。扩展此标记将显示物理引擎内部完成的工作的低级细节。</li>
<li>
<strong>Physics.FetchResults：</strong>从 <code>FixedUpdate</code> 中调用。从物理引擎收集物理模拟结果。</li>
<li>
<strong>Physics.UpdateBodies：</strong>从 <code>FixedUpdate</code> 中调用。更新所有物理体的位置和旋转以及发送说明这些更新的消息。</li>
<li>
<strong>Physics.ProcessReports：</strong>从 <code>FixedUpdate</code> 中调用。此阶段在物理 <code>FixedUpdate</code> 结束后运行，负责处理响应模拟结果的所有不同阶段。更新接触、关节破坏和触发器并发送相关消息。包括四个不同的子阶段：

<ul>
<li>
<strong>Physics.TriggerEnterExits：</strong>从 <code>FixedUpdate</code> 中调用。处理 <code>OnTriggerEnter</code> 和 <code>OnTriggerExit</code> 事件。</li>
<li>
<strong>Physics.TriggerStays：</strong>从 <code>FixedUpdate</code> 中调用。处理 <code>OnTriggerStay</code> 事件。</li>
<li>
<strong>Physics.Contacts：</strong>从 <code>FixedUpdate</code> 中调用。处理 <code>OnCollisionEnter</code>、<code>OnCollisionExit</code> 和 <code>OnCollisionStay</code> 事件。</li>
<li>
<strong>Physics.JointBreaks：</strong>从 <code>FixedUpdate</code> 中调用。处理与被破坏的关节相关的更新和消息。</li>
</ul>
</li>
<li>
<strong>Physics.UpdateCloth：</strong>从 <code>Update</code> 中调用。进行与布料及其蒙皮网格相关的更新。</li>
<li>
<strong>Physics.Interpolation：</strong>从 <code>Update</code> 中调用。此阶段处理所有物理对象的位置和旋转的插值。</li>
</ul>

<h2>性能警告</h2>

<p>CPU 性能分析器能够检测并警告一些常见的性能问题。查看 <strong>CPU Usage</strong> 时，这些问题会显示在下方面板的 <strong>Warning</strong> 列中。</p>

<figure>
<img src="../uploads/Main/ProfilerCPUWarningCount.png" alt="性能分析器警告指示已移动静态碰撞体">
<figcaption>性能分析器警告指示已移动静态碰撞体</figcaption>
</figure>

<p>性能分析器可检测的具体问题包括：</p>

<ul>
<li>
<strong>Rigidbody.SetKinematic</strong> [Re-create non-convex MeshCollider for Rigidbody]</li>
<li>
<strong>Animation.DestroyAnimationClip</strong> [触发 RebuildInternalState]</li>
<li>
<strong>Animation.AddClip</strong> [触发 RebuildInternalState]</li>
<li>
<strong>Animation.RemoveClip</strong> [触发 RebuildInternalState]</li>
<li>
<strong>Animation.Clone</strong> [触发 RebuildInternalState]</li>
<li>
<strong>Animation.Deactivate</strong> [触发 RebuildInternalState]</li>
</ul>

<p>在上面的截屏中，性能分析器显示了 <strong>Static Collider.Move</strong> 警告。<strong>Warning</strong> 列显示此警告已在当前帧中触发 12 次。术语“延迟成本”意味着，虽然性能分析器中的条目可能显示低成本（在此情况下为 0.00ms），但该操作可能会在以后触发更多消耗系统资源的操作。</p>

<h2>CPU Profiler Timeline</h2>

<h3>Mem Record：本机内存性能分析</h3>

<p>本机内存性能分析允许在 Unity 的本机内存管理系统中分析活动，并评估对运行时性能的影响。在 Unity 的内存管理中搜索不必要的或资源密集的分配模式时，此分析功能非常有用。</p>

<p>To profile Unity’s native memory management, you need to record it. To access native memory recording mode (called <strong>Mem Record</strong> in Unity), go to <strong>Window</strong> &gt; <strong>Analysis</strong> &gt; <strong>Profiler</strong> to open the Profiler window. Select the <strong>CPU Usage</strong> Profiler (if it is not visible, click <strong>Add Profiler</strong> &gt; <strong>CPU</strong>) then the drop-down menu underneath the Profiler. Next, click <strong>Timeline</strong> and then select <strong>Mem Record</strong>.</p>

<figure>
<img src="../uploads/Main/ProfilerCPU-MemRecord-SelectMode.png" alt="选择记录模式">
<figcaption>选择记录模式</figcaption>
</figure>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>选项</strong></th>
	<th style="text-align:left;"><strong>功能</strong></th>
	<th style="text-align:left;"><strong>对性能的影响</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><strong>None</strong></td>
	<td style="text-align:left;">禁用模式。这是默认选择。</td>
	<td style="text-align:left;">无</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Sample only</strong></td>
	<td style="text-align:left;">记录内存分配、重新分配、取消分配、活动类型和系统。</td>
	<td style="text-align:left;">低</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Callstack (fast)</strong></td>
	<td style="text-align:left;">此选项具有与 <strong>Sample only</strong> 相同的功能，但还记录来自本机分配站点的快捷调用栈（调用栈从本机符号转换为脚本符号）。实际上，最多只能看到最深脚本符号的调用栈。</td>
	<td style="text-align:left;">中</td>
</tr>
<tr>
	<td style="text-align:left;"><strong>Callstack (full)</strong></td>
	<td style="text-align:left;">此选项具有与 <strong>Sample only</strong> 相同的功能，但还记录具有完整脚本到本机转换和本机到脚本转换的调用栈。</td>
	<td style="text-align:left;">高</td>
</tr>
</tbody>
</table>

<p><strong>注意：</strong>当激活的性能分析器仅连接到独立平台播放器时，仅支持低影响力的 <strong>Sample only</strong> 模式。</p>

<p>记录的内存分配样本以亮红色显示在 Profiler 窗口中。</p>

<figure>
<img src="../uploads/Main/ProfilerCPU-MemRecord-Allocation.png" alt="">
</figure>

<p>单击 <strong>Mem Record</strong> 旁边的 <strong>High Detail</strong> 按钮可启用 High Detail 模式。选择一个样本来显示分配类型和系统。如果为所选分配样本记录了调用栈，则还会解析并显示关联的调用栈符号：</p>

<figure>
<img src="../uploads/Main/ProfilerCPU-MemRecord-HighDetail.jpg" alt="">
</figure>

<h4>使用 Mem Record</h4>

<p>在许多情况下，__Mem Record__ 功能很有用。例如：</p>

<ul>
<li>了解系统何时进行大量小型分配而不仅仅是少量大型分配。</li>
<li>了解何时工作线程意外分配内存（例如，通过意外使用 MemLabel）。</li>
<li>查找锁争用（多个线程尝试同时访问本机内存系统时）。</li>
<li>查找内存碎片的来源（对于低内存设备尤为重要）。</li>
</ul>

<h2>Timeline 的 High Detail 视图</h2>

<p>CPU Usage Profiler Timeline 的 <strong>High Detail</strong> 视图为 Unity 的 CPU Usage Profiler 记录的每个样本提供至少一个宽度像素。</p>

<p>这样便可查看帧中所有活动的完整概况，包括线程同步或内存分配等短期活动。</p>

<p>To enable the <strong>High Detail</strong> view, go to <strong>Window</strong> &gt; <strong>Analysis</strong> &gt; <strong>Profiler</strong> to open the Profiler window. Select the <strong>CPU Usage</strong> Profiler (if it is not visible, click <strong>Add Profiler</strong> &gt; <strong>CPU</strong>) then select the drop-down menu underneath the Profiler and click <strong>Timeline</strong> followed by <strong>High Detail</strong>.</p>

<figure>
<img src="../uploads/Main/CPUProfilerHighDetail.png" alt="">
</figure>

<h2>比较</h2>

<p>以下两个图显示了 CPU Usage Profiler Timeline 的 <strong>High Detail</strong> 视图与普通视图之间的区别。</p>

<h3>High Detail 视图</h3>

<figure>
<img src="../uploads/Main/CPUProfilerinHighDetail.png" alt="">
</figure>

<h3>普通视图</h3>

<figure>
<img src="../uploads/Main/CPUProfilerNormalDetail.png" alt="">
</figure>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProfilerWindow.html"></a></span><div class="tip">Profiler 窗口</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ProfilerRendering.html"></a></span><div class="tip">渲染性能分析器 (Rendering Profiler)</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2019 Unity Technologies. Publication 2019.1</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
