<!DOCTYPE html><html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="Low-level native plug-in Profiler API - Unity Manual">
<title>Low-level native plug-in Profiler API - Unity Manual</title>
<meta name="description" content="The Unity Profiler native plug-in enables you to extract data from Unity via script for analysis in an external tool, such as Razor (PS4), PIX (Xbox, Windows), Chrome Tracing, ETW, ITT, Vtune and Telemetry. The Unity Profiler records events, and the Profiler native plug-in API exposes these events to a third-party profiling API, which passes them to the relevant analysis tool.">
<meta property="og:description" content="The Unity Profiler native plug-in enables you to extract data from Unity via script for analysis in an external tool, such as Razor (PS4), PIX (Xbox, Windows), Chrome Tracing, ETW, ITT, Vtune and Telemetry. The Unity Profiler records events, and the Profiler native plug-in API exposes these events to a third-party profiling API, which passes them to the relevant analysis tool.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'LowLevelNativePluginProfiler';
      if(!page) page = 'index';
      var version = '2019.1';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/LowLevelNativePluginProfiler.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/LowLevelNativePluginProfiler.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/LowLevelNativePluginProfiler.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/LowLevelNativePluginProfiler.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/LowLevelNativePluginProfiler.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/LowLevelNativePluginProfiler.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/LowLevelNativePluginProfiler.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/LowLevelNativePluginProfiler.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/LowLevelNativePluginProfiler.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/LowLevelNativePluginProfiler.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/LowLevelNativePluginProfiler.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/LowLevelNativePluginProfiler.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.1/Documentation/Manual/LowLevelNativePluginProfiler.html">English</a></li>
<li><a data-lang="ja" href="/ja/2019.1/Manual/LowLevelNativePluginProfiler.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.1/Manual/LowLevelNativePluginProfiler.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.1/Manual/LowLevelNativePluginProfiler.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.1</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/LowLevelNativePluginProfiler.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/LowLevelNativePluginProfiler.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/LowLevelNativePluginProfiler.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/LowLevelNativePluginProfiler.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/LowLevelNativePluginProfiler.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/LowLevelNativePluginProfiler.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/LowLevelNativePluginProfiler.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/LowLevelNativePluginProfiler.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/LowLevelNativePluginProfiler.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/LowLevelNativePluginProfiler.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/LowLevelNativePluginProfiler.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/LowLevelNativePluginProfiler.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.1)</a></li>
<li><a href="UnityOverview.html">在 Unity 中操作</a></li>
<li><a href="AdvancedDevelopment.html">高级开发</a></li>
<li><a href="Plugins.html">Plug-ins</a></li>
<li><a href="NativePluginInterface.html">Low-level native plug-in interface</a></li>
<li>Low-level native plug-in Profiler API</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="NativePluginInterface.html"></a></span><div class="tip">Low-level native plug-in interface</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="LowLevelNativePluginRenderingExtensions.html"></a></span><div class="tip">Low-level native plug-in rendering extensions</div>
</div>
</div></div>
<h1>Low-level native plug-in Profiler API</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>The <a href="Profiler.html">Unity Profiler</a> native plug-in enables you to extract data from Unity via script for analysis in an external tool, such as Razor (PS4), PIX (Xbox, Windows), Chrome Tracing, ETW, ITT, Vtune and Telemetry. The Unity Profiler records events, and the Profiler <a href="NativePlugins.html">native plug-in</a><a href="NativePlugins.html"> API</a> exposes these events to a third-party profiling API, which passes them to the relevant analysis tool.</p>

<p>The following Unity Profiler features help capture instrumentation data for performance analysis:</p>

<ul>
<li><p><strong>Categories</strong>: Unity groups profile data into categories (such as Rendering, Scripting and Animation), and assigns a color to each category. This helps you visually distinguish the types of data in the Profiler window. The Profiler native plug-in API enables you to retrieve these colors so you can use them in an external profiler.</p></li>
<li>
<p><strong>Usage flags</strong>: The Unity Profiler applies the following usage flags to event markers to help filter the data:</p>

<ul>
<li><p>Availability flags that describe whether a marker is available in the Unity Editor, or a Development or Release Player.</p></li>
<li><p>Verbosity levels that correlate to the type of the task you are doing in the Editor, and the level of information that task requires (for example, internal, debug, or user level). </p></li>
</ul>

<p>Usage flags allow you to filter the data before you pass it to an external tool to reduce the amount of generated data, and filter the data in an external tool to reduce noise in the information.</p>
</li>
<li><p><strong>Frame events</strong>: The Profiler native plug-in API enables you to do frame time analysis in an external profiler.</p></li>
<li><p><strong>Thread profiling</strong>: Unity does a significant amount of work on threads (for example, the main thread, render thread and job system worker thread). You can use the Profiler native plug-in API to enable profiling on any thread.</p></li>
</ul>

<h2>Plug-in API callbacks</h2>

<p>The native Profiler plug-in API provides the interface between Unity’s subsystems and third-party profiling APIs. The API is exposed by the <em>IUnityProfilerCallbacks</em> header, which Unity stores in the <em>&lt;UnityInstallPath&gt;\Editor\Data\PluginAPI</em> folder of your Unity installation.</p>

<p>To use the instrumentation data that the Unity Profiler generates in an external profiler, use this minimal set of callbacks:</p>

<ol>
<li><p><code>RegisterCreateCategoryCallback</code>: Whenever Unity creates a category, the Profiler gets the category name and color, and registers this callback .</p></li>
<li><p><code>RegisterCreateMarkerCallback</code>: Whenever Unity creates a marker, the Profiler gets the marker name, category and usage flags, and registers this callback. UnityProfilerMarkerDesc represents a persistent pointer which you can use to filter markers in RegisterMarkerEventCallback. </p></li>
<li><p><code>RegisterMarkerEventCallback</code>: Tracks the external profiler push/pop markers with the Unity Profiler equivalents, and registers an event callback for the given marker. The Unity Profiler runs the specified callback when a scoped instrumentation event or a single-shot event occurs. You can also track memory allocation and garbage collection events as markers. Unity represents these events as <code>GC.Alloc</code> and <code>GC.Collect</code> respectively.</p></li>
<li><p><code>RegisterFrameCallback</code>: Encapsulates samples into logical frames for use in external profilers that don’t have a concept of frames, and registers a callback that the Unity Profiler runs when Unity starts the next logical CPU frame.</p></li>
<li><p><code>RegisterCreateThreadCallback</code>: Whenever Unity registers a thread for profiling, the Profiler gets the internal thread name, and registers this callback for that thread.</p></li>
</ol>

<h2>Usage examples</h2>

<h3>Minimal example</h3>

<p>The following example shows you how to send begin and end events to an external profiler:</p>

<pre><code>| #include &lt;IUnityInterface.h&gt;
#include &lt;IUnityProfilerCallbacks.h&gt;&lt;br/&gt;
static IUnityProfilerCallbacks* s_UnityProfilerCallbacks = NULL;
static void UNITY_INTERFACE_API MyProfilerEventCallback(
    const UnityProfilerMarkerDesc* markerDesc,
    UnityProfilerMarkerEventType eventType,
    unsigned short eventDataCount,
    const UnityProfilerMarkerData* eventData, void* userData)
{
    switch (eventType)
    {
        case kUnityProfilerMarkerEventTypeBegin:
        {
            MyProfilerPushMarker(markerDesc-&gt;name);
            break;
        }
        case kUnityProfilerMarkerEventTypeEnd:
        {
            MyProfilerPopMarker(markerDesc-&gt;name);
            break;
        }
    }
}
static void UNITY_INTERFACE_API MyProfilerCreateEventCallback(
    const UnityProfilerMarkerDesc* markerDesc, void* userData)
{
    s_UnityProfilerCallbacks-&gt;
      RegisterEventCallback(markerDesc, MyProfilerEventCallback, NULL);
}
extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginLoad(IUnityInterfaces* unityInterfaces)
{
    s_UnityProfilerCallbacks = unityInterfaces-&gt;Get&lt;IUnityProfilerCallbacks&gt;();
    s_UnityProfilerCallbacks-&gt;
      RegisterCreateEventCallback(&amp;MyProfilerCreateEventCallback, NULL);
}
extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API UnityPluginUnload()
{
    s_UnityProfilerCallbacks-&gt;
      UnregisterCreateEventCallback(&amp;MyProfilerCreateEventCallback, NULL);
    s_UnityProfilerCallbacks-&gt;
      UnregisterEventCallback(NULL, &amp;MyProfilerEventCallback, NULL);
}
</code></pre>

<p><strong>Note</strong>: To unregister the given callback from all markers, run UnregisterEventCallback with the first parameter set to NULL.</p>

<h3>UnitySystracePlugin example</h3>

<p>You can register and unregister marker callbacks dynamically, once every frame. The following example shows you how to minimize profiling overhead by enabling and disabling callbacks, depending on a third party profile state. </p>

<pre><code>| static void UNITY_INTERFACE_API SystraceFrameCallback(void* userData)
{
    bool isCapturing = ATrace_isEnabled();
    if (isCapturing != s_isCapturing)
    {
        s_isCapturing = isCapturing;
        if (isCapturing)
        {
            s_UnityProfilerCallbacks-&gt;&lt;br/&gt;              RegisterCreateMarkerCallback(SystraceCreateEventCallback, NULL);
        }
        else
        {
            s_UnityProfilerCallbacks-&gt;
              UnregisterCreateMarkerCallback(SystraceCreateEventCallback, NULL);
            s_UnityProfilerCallbacks-&gt;
              UnregisterMarkerEventCallback(NULL, SystraceEventCallback, NULL);
        }
    }
}
</code></pre>

<p><strong>Note</strong>: To minimize callback overhead, you can register callbacks only for the duration of the capture.</p>

<p>The Systrace API provides the ATrace_isEnabled API, which determines whether capturing is enabled. You can check this on a per-frame basis to enable or disable callbacks dynamically. For a more advanced usage example, see the <a href="https://github.com/Over17/UnitySystracePlugin">UnitySystracePlugin repository</a>.</p>

<h2>Useful markers</h2>

<p>Unity has the following markers that contain useful metadata:</p>

<h3>Profiler.DefaultMarker</h3>

<p>A marker that Unity reserves for <a href="../ScriptReference/Profiling.Profiler.BeginSample.html">Profiler.BeginSample</a> and <a href="../ScriptReference/Profiling.Profiler.EndSample.html">Profiler.EndSample</a> events. <code>kUnityProfilerMarkerEventTypeBegin eventType</code> corresponds to the <code>Profiler.BeginSample</code> event and has the following data:</p>

<ul>
<li><p>Int32: The <code>UnityEngine.Object</code> instance id or 0 if the object is not specified. </p></li>
<li><p>UInt16 array: The UTF16 string that is passed to <code>Profiler.BeginSample</code>. The size is in bytes.</p></li>
<li><p>UInt32: The category index.</p></li>
</ul>

<h3>GC.Alloc</h3>

<p>A marker that corresponds to garbage collection allocation. It has the following data: </p>

<ul>
<li>Int64: The size of the allocation.</li>
</ul>

<hr>

<ul>
<li><p><span class="page-edit">2019–02–14 Page published with <a href="DocumentationEditorialReview.html">editorial review</a>
</span></p></li>
<li><p><span class="page-history">Low-level Profiler native plug-in added in Unity <a href="../Manual/30_search.html?q=newin20183">2018.3</a> <span class="search-words">NewIn20183</span></span></p></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="NativePluginInterface.html"></a></span><div class="tip">Low-level native plug-in interface</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="LowLevelNativePluginRenderingExtensions.html"></a></span><div class="tip">Low-level native plug-in rendering extensions</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2019 Unity Technologies. Publication 2019.1</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
