<!DOCTYPE html><html class="no-js"><head><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="twitter:card" content="summary" /><meta name="robots" content="noindex" /><meta property="og:title" content="MonoBehaviour-OnAudioFilterRead(float[], int) - Unity Scripting API" /><title>MonoBehaviour-OnAudioFilterRead(float[], int) - Unity Scripting API</title><meta name="description" content="如果实现了 OnAudioFilterRead，Unity 将在音频 DSP 链中插入一个自定义滤波器。" /><meta property="og:description" content="如果实现了 OnAudioFilterRead，Unity 将在音频 DSP 链中插入一个自定义滤波器。" /><meta name="author" content="Unity Technologies" /><link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico" /><link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png" /><link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png" /><link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png" /><link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png" /><link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png" /><link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png" /><link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png" /><meta name="msapplication-TileColor" content="#222c37" /><meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png" /><script>
      var docs_type = 'ScriptReference';
      var lang = 'zh_CN';
      var page = 'MonoBehaviour-OnAudioFilterRead(float[], int)';
      if(!page) page = 'index';
      var version = '2019.1';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css" /><link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css" /></head><body><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="header-wrapper"><div id="header" class="header"><div class="content"><div class="spacer"><div class="menu"><div id="nav-open" for="nav-input"><span></span></div><div class="logo"><a href="https://docs.unity3d.com"></a></div><div class="search-form"><form action="30_search.html" method="get" class="apisearch"><input type="text" name="q" placeholder="Search scripting..." autosave="Unity Reference" results="5" class="sbox field" id="q"></input><input type="submit" class="submit"></input></form></div><ul class="menu-items"><li class="menu-item"><a href="../Manual/index.html" class="">Manual</a></li><li class="menu-item"><a href="../ScriptReference/index.html" class="selected">Scripting API</a></li></ul></div></div><div class="more"><div class="filler"></div><ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul></div></div></div><div class="toolbar"><div class="content"><div class="version-switcher"><div class="current toggle" data-target=".version-list"><div class="version-number"><div class="d-inline-block">
          Version:
          <b>2019.1</b></div><div class="d-inline-block arrow"></div></div></div><div class="version-list" style="display:none;"><ul><li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.3</a></li><li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.2</a></li><li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.1</a></li><li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.4</a></li><li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.3</a></li><li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.2</a></li><li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.1</a></li><li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.4</a></li><li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.3</a></li><li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.2</a></li><li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.1</a></li><li><a class="docs_version_url_560" href="/zh_CN/560/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">5.6</a></li></ul></div></div><ul class="nav-menu-items"><li class="menu-item"><a href="../Manual/index.html" class="">Manual</a></li><li class="menu-item"><a href="../ScriptReference/index.html" class="selected">Scripting API</a></li></ul><div class="lang-switcher"><div class="current toggle" data-target=".lang-list"><div class="lbl">Language:
        <span class="b">中文</span></div><div class="arrow"></div></div><div class="lang-list" style="display:none;"><ul><li><a data-lang="en" href="/2019.1/Documentation/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">English</a></li><li><a data-lang="ja" href="/ja/2019.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">日本語</a></li><li><a data-lang="es" href="/es/2019.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">Español</a></li><li><a data-lang="kr" href="/kr/2019.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">한국어</a></li></ul></div></div></div></div></div><div id="master-wrapper" class="master-wrapper clear"><div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Scripting API</h2><div class="version-switcher"><div class="current toggle" data-target=".version-list"><div class="version-number"><div class="d-inline-block">
          Version:
          <b>2019.1</b></div><div class="d-inline-block arrow"></div></div></div><div class="version-list" style="display:none;"><ul><li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.3</a></li><li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.2</a></li><li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2019.1</a></li><li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.4</a></li><li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.3</a></li><li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.2</a></li><li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2018.1</a></li><li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.4</a></li><li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.3</a></li><li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.2</a></li><li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">2017.1</a></li><li><a class="docs_version_url_560" href="/zh_CN/560/ScriptReference/MonoBehaviour-OnAudioFilterRead(float[], int).html">5.6</a></li></ul></div></div><div class="clear"></div></div></div></div></div></div><div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content"><div class="section"><div class="mb20 clear" id=""><h1 class="heading inherit"><a href="MonoBehaviour.html">MonoBehaviour</a>.OnAudioFilterRead(float[], int)</h1><div class="clear"></div><div class="clear"></div><a href="" class="switch-link gray-btn sbtn left hide">Switch to Manual</a><div class="clear"></div></div><div class="subsection"><div class="signature"><div class="signature-CS sig-block"><span style="color:red;"></span></div></div></div><div class="subsection"><h2>Parameters</h2><table class="list"><tr><td class="name lbl">data</td><td class="desc">一个包含音频数据的<code class="mono">浮点值数组</code>。</td></tr><tr><td class="name lbl">channels</td><td class="desc">一个 <code class="mono">int</code>，用于存储传递给该委托的音频数据的声道数。</td></tr></table></div><div class="subsection"><h2>Description</h2><p>如果实现了 OnAudioFilterRead，Unity 将在音频 DSP 链中插入一个自定义滤波器。</p></div><div class="subsection"><p>The filter is inserted in the same order as the MonoBehaviour script is shown in the Inspector.<br /><br />OnAudioFilterRead is called every time a chunk of audio is sent to the filter (this happens frequently, every ~20ms depending on the sample rate and platform).
The audio data is an array of floats ranging from [-1.0f;1.0f] and contains audio from the previous filter in the chain or the <a href="AudioClip.html">AudioClip</a> on the <a href="AudioSource.html">AudioSource</a>. If this is the first filter in the chain and a clip isn't attached to the audio source, this filter will be played as the audio source. In this way you can use the filter as the audio clip, procedurally generating audio.<br /><br />如果有多个声道，则以交错方式处理声道数据。这意味着数组中的每个连续数据样本都来自不同的声道，直到声道结束并循环回第一个声道。<code class="mono">data.Length</code> 报告数据的总大小，以便找到每个声道的样本数（用 <code class="mono">data.Length</code> 除以 <code class="mono">channels</code>）。<br /><br />If OnAudioFilterRead is implemented a VU meter is shown in the Inspector displaying the outgoing sample level. The process time of the filter is also measured and the spent milliseconds are shown next to the VU meter. The number turns red if the filter is taking up too much time, meaning the mixer will be starved of audio data.<br /><br />另请注意，OnAudioFilterRead 是在主线程（称为音频线程）以外的线程上调用的，因此不允许从该函数调用许多 Unity 函数（如果您尝试这样做，将在运行时显示一条警告）。<br /><br />另请参阅：<a href="../Manual/class-AudioEffect.html">音频滤波器</a>。</p></div><div class="subsection">
        
        <pre class="codeExampleCS">
using UnityEngine;<br /><br />// The code example shows how to implement a metronome that procedurally
// generates the click sounds via the OnAudioFilterRead callback.
// While the game is paused or suspended, this time will not be updated and sounds
// playing will be paused. Therefore developers of music scheduling routines do not have
// to do any rescheduling after the app is unpaused<br /><br />[<a href="RequireComponent.html">RequireComponent</a>(typeof(<a href="AudioSource.html">AudioSource</a>))]
public class AudioTest : <a href="MonoBehaviour.html">MonoBehaviour</a>
{
    public double bpm = 140.0F;
    public float gain = 0.5F;
    public int signatureHi = 4;
    public int signatureLo = 4;<br /><br />    private double nextTick = 0.0F;
    private float amp = 0.0F;
    private float phase = 0.0F;
    private double sampleRate = 0.0F;
    private int accent;
    private bool running = false;<br /><br />    void Start()
    {
        accent = signatureHi;
        double startTick = <a href="AudioSettings-dspTime.html">AudioSettings.dspTime</a>;
        sampleRate = <a href="AudioSettings-outputSampleRate.html">AudioSettings.outputSampleRate</a>;
        nextTick = startTick * sampleRate;
        running = true;
    }<br /><br />    void OnAudioFilterRead(float[] data, int channels)
    {
        if (!running)
            return;<br /><br />        double samplesPerTick = sampleRate * 60.0F / bpm * 4.0F / signatureLo;
        double sample = <a href="AudioSettings-dspTime.html">AudioSettings.dspTime</a> * sampleRate;
        int dataLen = data.Length / channels;<br /><br />        int n = 0;
        while (n &lt; dataLen)
        {
            float x = gain * amp * <a href="Mathf.Sin.html">Mathf.Sin</a>(phase);
            int i = 0;
            while (i &lt; channels)
            {
                data[n * channels + i] += x;
                i++;
            }
            while (sample + n &gt;= nextTick)
            {
                nextTick += samplesPerTick;
                amp = 1.0F;
                if (++accent &gt; signatureHi)
                {
                    accent = 1;
                    amp *= 2.0F;
                }
                <a href="Debug.Log.html">Debug.Log</a>("Tick: " + accent + "/" + signatureHi);
            }
            phase += amp * 0.3F;
            amp *= 0.993F;
            n++;
        }
    }
}
</pre>
      </div></div><div class="footer-wrapper"><div class="footer clear"><div class="copy">Copyright © 2019 Unity Technologies. Publication 2019.1</div><div class="menu"><a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a></div></div><div></div></div></div></div></div></div></body></html>